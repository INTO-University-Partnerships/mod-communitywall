!function e(t,n,o){function i(a,s){if(!n[a]){if(!t[a]){var c="function"==typeof require&&require;if(!s&&c)return c(a,!0);if(r)return r(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var u=n[a]={exports:{}};t[a][0].call(u.exports,function(e){var n=t[a][1][e];return i(n?n:e)},u,u.exports,e,t,n,o)}return n[a].exports}for(var r="function"==typeof require&&require,a=0;a<o.length;a++)i(o[a]);return i}({1:[function(e,t,n){"use strict";var o=angular.module("wallsApp",["wallsApp.controllers","wallsApp.services","wallsApp.directives","ngSanitize","ngDragDrop"]);o.constant("CONFIG",window.CONFIG),delete window.CONFIG},{}],2:[function(e,t,n){"use strict";e("./angular-app"),e("./controllers"),e("./directives"),e("./services")},{"./angular-app":1,"./controllers":3,"./directives":4,"./services":5}],3:[function(e,t,n){"use strict";var o=angular.module("wallsApp.controllers",[]);o.controller("wallsCtrl",["$scope","$timeout","$window","wallsSrv","CONFIG",function(e,t,n,o,i){e.walls=[],e.total=-1,e.perPage=5,e.currentPage=0,e.baseurl=i.baseurl,e.canManage=i.canManage,e.closed=i.closed,e.isGuest=i.isGuest,e.timeoutPromise=null,e.prevPage=function(){e.currentPage>0&&--e.currentPage},e.prevPageDisabled=function(){return 0===e.currentPage?"disabled":""},e.nextPage=function(){e.currentPage<e.pageCount()-1&&e.currentPage++},e.nextPageDisabled=function(){return e.currentPage===e.pageCount()-1?"disabled":""},e.pageCount=function(){return 0===e.total?1:Math.ceil(e.total/e.perPage)},e.getPageOfWalls=function(n){t.cancel(e.timeoutPromise),o.getPageOfWalls(n,e.perPage).then(function(n){e.walls=n.walls,e.total=n.total,e.timeoutPromise=t(function(){e.getPageOfWalls(e.currentPage)},i.pollInterval)})},e.$watch("currentPage",function(t){e.getPageOfWalls(t)}),e.addWall=function(){n.location.href=i.baseurl+"/"+i.instanceid+"/add"},e.editWall=function(e){n.location.href=i.baseurl+"/"+i.instanceid+"/edit/"+e},e.deleteWall=function(t){n.confirm(i.messages.confirmDeleteWall)&&o.deleteWall(t).then(function(){e.currentPage>0&&(e.total-1)%e.perPage===0&&--e.currentPage,e.getPageOfWalls(e.currentPage)})}}]),o.controller("notesCtrl",["$scope","$timeout","$window","notesSrv","CONFIG",function(e,t,n,o,i){e.baseurl=i.baseurl,e.canManage=i.canManage,e.closed=i.closed,e.isGuest=i.isGuest,e.notes=null,e.total=null,e.timeoutPromise=null,e.editingId=null,e.addingNote=!1,e.noteContainerDisabled=!1;var r=function(){t.cancel(e.timeoutPromise)},a=function(){t.cancel(e.timeoutPromise),e.timeoutPromise=t(e.getNotes,i.pollInterval)};e.startEditing=function(t){e.editingId=t,r(),e.$digest()},e.stopAdding=function(t,n){"undefined"!=typeof n&&n.stopPropagation(),e.addingNote=!1,t&&e.$digest()},e.stopEditing=function(t){"undefined"!=typeof t&&t.stopPropagation(),e.editingId=null,a()},e.$on("startDragging",function(){r()}),e.setNotes=function(t){e.notes=t.notes,e.total=t.total,a(),e.noteContainerDisabled=!1},e.getNotes=function(){r(),e.noteContainerDisabled=!0,o.getNotes().then(e.setNotes)},e.postNote=function(t,n){"undefined"!=typeof n&&n.stopPropagation(),r(),e.addingNote=!1,e.noteContainerDisabled=!0,o.postNote({note:t.note,xcoord:t.xcoord,ycoord:t.ycoord}).then(e.setNotes)},e.putNote=function(t,n){"undefined"!=typeof n&&n.stopPropagation(),r(),e.editingId=null,e.noteContainerDisabled=!0,o.putNote(t.id,t).then(e.setNotes)},e.deleteNote=function(t,a){"undefined"!=typeof a&&a.stopPropagation(),n.confirm(i.messages.confirmDeleteNote)&&(r(),e.editingId=null,e.noteContainerDisabled=!0,o.deleteNote(t).then(e.setNotes))},e.backToCommunityWalls=function(){n.location.href=i.baseurl+"/"+i.instanceid},e.getNotes()}])},{}],4:[function(e,t,n){"use strict";var o=angular.module("wallsApp.directives",[]),i=27,r=function(){var e={x:0,y:0},t=document.getElementsByClassName("communitywall-note-container");if(t&&t.length){var n=t[0].getBoundingClientRect(),o=document.getElementsByClassName("add-note");if(o&&o.length){var i=o[0].getBoundingClientRect();e.x=Math.floor((n.width-i.width)*Math.random()),e.y=Math.floor((n.height-i.height)*Math.random())}}return e};o.directive("wallListItem",["CONFIG",function(e){return{restrict:"E",scope:{wall:"=",baseurl:"@",canManage:"@",closed:"@",editT:"&",deleteT:"&"},templateUrl:e.baseurl+"/partials/wallListItem.twig"}}]),o.directive("communitywallNoteContainer",[function(){return{restrict:"A",link:function(e,t){t.bind("click",function(t){e.$broadcast("containerClicked",t)})}}}]),o.directive("addNote",["CONFIG","$timeout",function(e,t){return{restrict:"E",scope:{saveChanges:"&",stopAdding:"&",addingNote:"=",isGuest:"="},link:function(e,n){e.disappear=function(){n.find("div").parent().css("opacity",0)},e.appear=function(){n.find("div").parent().css("opacity",1)},e.disappear(),e.$watch("addingNote",function(o,i){o===!0&&i===!1&&(e.noteText="",t(function(){var t=r();e.xcoord=t.x,e.ycoord=t.y,n.css({top:e.ycoord+"px",left:e.xcoord+"px"}),n.find("textarea")[0].focus(),e.appear()},1))}),e.$on("containerClicked",function(){e.addingNote!==!1&&(e.noteText.length&&e.saveChanges()({note:e.noteText,xcoord:e.xcoord,ycoord:e.ycoord}),e.stopAdding()(!0),e.disappear())}),e.onKeyPress=function(t){t.keyCode===i&&(e.stopAdding()(!1),e.disappear())}},templateUrl:e.baseurl+"/partials/addNote.twig"}}]),o.directive("viewNote",["CONFIG","$timeout","$rootScope","notesSrv",function(e,t,n,o){return{restrict:"E",scope:{canManage:"=",closed:"=",editingId:"=",startEditing:"&",stopEditing:"&",saveChanges:"&",deleteNote:"&",note:"=",ngTitle:"="},link:function(e,r){r.attr("title",e.ngTitle),e.temporarilyIgnoreClicks=!1;var a=r.find("textarea");a.focus(function(){var t=e.note.note.length;return this.setSelectionRange(t,t),!1}).mouseup(function(){return!1}),r.css({top:e.note.ycoord+"px",left:e.note.xcoord+"px",zIndex:e.note.id}),e.$watch("editingId",function(n,i){return n&&i&&n!==i&&i===e.note.id?void o.putNote(e.note.id,{note:e.note.note}):void(n&&n===e.note.id&&(e.editingDisabled=!0,o.getNoteText(e.note.id).then(function(n){e.editingDisabled=!1,e.initialNoteText=e.note.note=n,t(function(){a.focus()},1)})))}),e.$on("containerClicked",function(){e.editingId===e.note.id&&e.saveChanges()({id:e.note.id,note:e.note.note})}),r.bind("click",function(t){t.stopPropagation(),e.temporarilyIgnoreClicks||e.editingId!==e.note.id&&(e.note.is_owner&&!e.closed||e.canManage)&&e.startEditing()(e.note.id)}),r.bind("dragstart",function(t){return null!==e.editingId?void t.preventDefault():void n.$broadcast("startDragging")}),r.bind("dragstop",function(){e.saveChanges()({id:e.note.id,xcoord:angular.element(r).position().left||0,ycoord:angular.element(r).position().top||0}),e.temporarilyIgnoreClicks=!0,t(function(){e.temporarilyIgnoreClicks=!1},100)}),e.onKeyPress=function(t){t.keyCode===i&&(e.note.note=e.initialNoteText,e.stopEditing()())}},templateUrl:e.baseurl+"/partials/viewNote.twig"}}])},{}],5:[function(e,t,n){"use strict";var o=angular.module("wallsApp.services",[]);o.service("wallsSrv",["$http","$q","CONFIG",function(e,t,n){var o=n.baseurl+n.api+"/wall/"+n.instanceid;this.getPageOfWalls=function(n,i){var r=t.defer();return e.get(o+"?limitfrom="+n*i+"&limitnum="+i).success(function(e){r.resolve(e)}).error(function(e){r.reject(e)}),r.promise},this.deleteWall=function(n){var i=t.defer();return e["delete"](o+"/"+n).success(function(e){i.resolve(e)}).error(function(e){i.reject(e)}),i.promise}}]),o.service("notesSrv",["$http","$q","CONFIG",function(e,t,n){var o=n.baseurl+n.api+"/wall/"+n.instanceid+"/"+n.wallid+"/note";this.getNotes=function(){var n=t.defer();return e.get(o).success(function(e){n.resolve(e)}).error(function(e){n.reject(e)}),n.promise},this.getNoteText=function(n){var i=t.defer();return e.get(o+"/text/"+n).success(function(e){i.resolve(e)}).error(function(e){i.reject(e)}),i.promise},this.postNote=function(n){var i=t.defer();return e.post(o,n).success(function(e){i.resolve(e)}).error(function(e){i.reject(e)}),i.promise},this.putNote=function(n,i){var r=t.defer();return e.put(o+"/"+n,i).success(function(e){r.resolve(e)}).error(function(e){r.reject(e)}),r.promise},this.deleteNote=function(n){var i=t.defer();return e["delete"](o+"/"+n).success(function(e){i.resolve(e)}).error(function(e){i.reject(e)}),i.promise}}])},{}]},{},[2]);